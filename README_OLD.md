# entity-manager

An Electron application with Vue and TypeScript

## Recommended IDE Setup

- [VSCode](https://code.visualstudio.com/) + [ESLint](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint) + [Prettier](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode) + [Volar](https://marketplace.visualstudio.com/items?itemName=Vue.volar)

## Project Setup

### Install

```bash
$ npm install
```

### Development

```bash
$ npm run dev
```

### Build

```bash
# For windows
$ npm run build:win

# For macOS
$ npm run build:mac

# For Linux
$ npm run build:linux
```

# 实体管理程序开发需求说明

## 项目概述

基于 Electron + Vue 3 + ElementPlus 开发一个具有插件系统的实体管理桌面应用程序，界面风格参考 VS Code 和 Obsidian。程序核心是管理可扩展的实体数据，支持插件系统自定义功能。

## 核心技术栈

- **前端框架**: Vue 3 + TypeScript + Composition API
- **UI组件库**: ElementPlus + 自定义样式
- **桌面框架**: Electron (主进程/渲染进程架构)
- **IPC通信**: Electron IPC 主进程/渲染进程通信
- **构建工具**: Vite + Electron Builder
- **样式**: SCSS + CSS Variables

## 核心功能模块

### 1. 实体管理系统

- **实体类型定义**: 支持创建自定义实体类型（如任务、联系人、项目等）
- **字段管理**: 固定字段（ID、名称、创建时间等）+ 自定义字段扩展
- **CRUD操作**: 完整的增删改查功能
- **批量操作**: 批量导入/导出、批量删除

### 2. 文件管理系统

- **`.em` 文件格式**: 自定义压缩文件格式，包含 `data.json` 和 `meta.json`
- **文件操作**: 打开、保存、导入、导出 `.em` 文件
- **数据恢复**: 从 `.em` 文件恢复完整程序状态

### 3. 插件管理系统

- **插件生命周期**: 加载、初始化、激活、卸载
- **插件事件系统**: 插件间通信和程序事件订阅
- **插件API**: 通过 `PluginContext` 提供受限的程序访问权限
- **自动扫描**: 自动加载指定目录下的插件

### 4. 数据看板系统

- **自定义看板**: 用户可配置数据展示看板
- **模板系统**: 预置统计图表和布局模板
- **扩展机制**: 通过放置 Vue 组件文件添加自定义看板

### 5. 配置管理系统

- **统一配置**: 管理程序设置和插件配置
- **持久化**: 配置自动保存到本地文件
- **配置同步**: 支持多设备配置同步（可选）

## 架构设计要求

### 进程架构

```
┌─────────────────┐    ┌─────────────────┐
│   主进程        │    │   渲染进程      │
│                 │    │                 │
│ • 实体管理逻辑  │◄───│ • Vue 组件      │
│ • 文件I/O      │    │ • 用户界面      │
│ • 插件管理器   │    │ • 状态管理      │
│ • 事件系统     │    │                 │
│ • IPC服务      │    └─────────────────┘
└─────────────────┘
```

### 关键实现要求

1. **主进程实现**: 所有核心业务逻辑在主进程中实现
2. **IPC通信**: 通过 IPC 暴露 API 给渲染进程
3. **数据转换**: Vue Proxy 对象使用 `toRaw()` 转换后通过 IPC 传递
4. **事件系统**: 两套独立系统（插件事件系统 + Electron IPC 系统）

## 界面设计规范

### 布局结构

```
┌─────────────────────────────────────────────────┐
│  菜单栏 (文件 编辑 视图 插件 帮助)                │
├───────────────┬─────────────────────────────────┤
│               │                                 │
│  左侧边栏     │          主工作区                │
│  (200px)      │          (自适应)               │
│  • 实体管理   │  • 实体列表/编辑器              │
│  • 看板       │  • 看板展示区                  │
│  • 插件管理   │  • 插件配置界面                │
│  • 设置       │                                 │
├───────────────┴─────────────────────────────────┤
│  状态栏 (实体数量 选中状态 插件状态)              │
└─────────────────────────────────────────────────┘
```

### 视觉风格

- **颜色方案**: VS Code 暗色主题 + Obsidian 的紫色点缀
- **字体**: 系统字体 (Windows: Segoe UI, macOS: SF Pro)
- **图标**: ElementPlus 图标 + 自定义 SVG
- **圆角**: 统一使用 6px 圆角
- **阴影**: 轻微阴影增强层次感

## 数据模型示例

### 实体字段统一结构

```typescript
interface EntityField {
  id: string // 字段ID
  name: string // 显示名称
  type: 'text' | 'number' | 'date' | 'select' | 'boolean'
  required?: boolean // 是否必填
  defaultValue?: any // 默认值
  options?: string[] // 选项列表（select类型）
}

// 固定字段
const FIXED_FIELDS: EntityField[] = [
  { id: 'id', name: 'ID', type: 'text', required: true },
  { id: 'name', name: '名称', type: 'text', required: true },
  { id: 'createdAt', name: '创建时间', type: 'date', required: true },
  { id: 'updatedAt', name: '更新时间', type: 'date', required: true }
]
```

### .em 文件示例结构

```json
// meta.json
{
  "version": "1.0.0",
  "name": "项目数据",
  "created": 1640995200000,
  "entityTypes": [
    {
      "id": "task",
      "name": "任务",
      "customFields": [
        { "id": "priority", "name": "优先级", "type": "select", "options": ["高", "中", "低"] }
      ]
    }
  ]
}

// data.json
{
  "entities": [
    {
      "_type": "task",
      "_id": "task_001",
      "name": "设计数据库",
      "priority": "高",
      "createdAt": 1640995200000
    }
  ],
  "settings": {},
  "dashboards": []
}
```

## 代码实现提示

### 关键注意事项

1. **IPC 类型安全**: 使用 TypeScript 接口定义 IPC 通信协议
2. **插件沙箱**: 插件在受限环境中运行，隔离潜在风险
3. **性能优化**: 大量数据使用虚拟滚动，避免界面卡顿
4. **错误处理**: 完善的错误捕获和用户友好提示

### 推荐实现顺序

1. 搭建 Electron + Vue3 基础框架
2. 实现实体管理核心功能
3. 添加文件系统支持（.em 格式）
4. 实现插件系统框架
5. 开发看板功能
6. 完善配置管理和界面美化



## 段落1：实体管理页面优化需求

**总体要求**：仅修改前端渲染进程代码，不修改后端API/主进程逻辑

### 特殊要求：
1. **功能按钮评估**：
   - 检查所有按钮（新建、编辑、删除、筛选、搜索等）
   - 对于点击无效的按钮：
     * 如果是必要的（如"高级筛选"），请实现功能：添加筛选条件面板，支持多字段组合筛选
     * 如果是冗余的（如"快速复制"但无实际逻辑），直接删除
   - 确保所有按钮都有明确的点击反馈和loading状态

2. **数据源改造**：
   - 删除模拟数据
   - 修改为通过IPC调用获取实际数据
   - 添加数据加载状态：loading骨架屏 + 空状态提示
   - 实现分页或虚拟滚动（如果数据量大）

3. **实体类型创建优化**：
   - 在"创建实体类型"表单中，添加"自定义字段"配置区
   - 字段配置组件应支持：
     * 字段类型选择（文本、数字、日期、下拉框、布尔值）
     * 必填选项
     * 默认值设置
     * 下拉框选项编辑
   - 使用ElementPlus的`el-dynamic`或自定义组件实现字段动态添加/删除
   - 保存时通过ipc提交完整配置

### 通用要求：
- **按钮评估标准**：
  - 保留并实现：功能合理，用户需要，已有或可添加后端支持
  - 暂时禁用：功能合理，但后端未实现，添加"开发中"提示
  - 删除：功能冗余，无实际使用场景，与其他功能重复
- **UI/UX改进**：
  - 所有表单提交添加防抖/节流
  - 添加操作成功/失败的轻提示（ElementPlus的ElMessage）
  - 长时间操作添加进度指示
  - 错误边界处理，友好错误提示

### 不修改范围：
1. 后端API接口签名（保持兼容）
2. 主进程的IPC处理逻辑
3. 数据库结构和数据模型
4. 文件格式（.em格式）的解析/生成逻辑
5. 插件系统的核心生命周期管理

### 验证要点：
1. ✅ 所有按钮点击都有实际效果或明确反馈
2. ✅ 无任何硬编码的模拟数据
3. ✅ 实体类型创建支持自定义字段
4. ✅ 所有数据修改都通过IPC与主进程通信
5. ✅ 保持现有功能完整，不破坏现有工作流

---

## 段落2：看板页面优化需求

**总体要求**：仅修改前端渲染进程代码，不修改后端API/主进程逻辑

### 特殊要求：
1. **移除静态模拟数据**：
   - 改为通过ipc获取实际统计信息
   - 每个看板组件应该接收实体类型ID作为参数，获取对应数据

2. **优化交互元素**：
   - 检查"刷新"按钮：实现定时或手动刷新数据
   - 检查"导出"按钮：实现通过IPC调用主进程导出功能

3. **增强看板配置**：
   - 在看板编辑模式中，允许选择数据源（实体类型）
   - 添加图表类型配置（柱状图、折线图、饼图等）
   - 实现看板布局的保存/加载

### 通用要求：
- **按钮评估标准**：
  - 保留并实现：功能合理，用户需要，已有或可添加后端支持
  - 暂时禁用：功能合理，但后端未实现，添加"开发中"提示
  - 删除：功能冗余，无实际使用场景，与其他功能重复
- **UI/UX改进**：
  - 所有表单提交添加防抖/节流
  - 添加操作成功/失败的轻提示（ElementPlus的ElMessage）
  - 长时间操作添加进度指示
  - 错误边界处理，友好错误提示

### 不修改范围：
1. 后端API接口签名（保持兼容）
2. 主进程的IPC处理逻辑
3. 数据库结构和数据模型
4. 文件格式（.em格式）的解析/生成逻辑
5. 插件系统的核心生命周期管理

### 验证要点：
1. ✅ 所有按钮点击都有实际效果或明确反馈
2. ✅ 无任何硬编码的模拟数据
3. ✅ 所有数据修改都通过IPC与主进程通信
4. ✅ 保持现有功能完整，不破坏现有工作流

---

## 段落3：插件管理页面优化需求

**总体要求**：仅修改前端渲染进程代码，不修改后端API/主进程逻辑

### 特殊要求：
1. **插件安装流程改造**：
   - 移除ZIP文件上传相关代码
   - 修改安装按钮逻辑：
     * 主进程将返回选择的文件夹路径
     * 前端显示文件夹选择结果和基本信息
     * 验证通过后显示安装确认界面

2. **优化插件列表**：
   - 删除硬编码的插件示例数据
   - 通过ipc获取已安装插件
   - 显示插件状态：已启用、已禁用、加载中、错误
   - 添加插件配置按钮，打开插件专属配置界面

3. **改进UI/UX**：
   - 插件卡片显示：名称、版本、描述、状态、操作按钮
   - 添加插件详情弹窗，展示README和配置项
   - 实现插件搜索和过滤功能

### 通用要求：
- **按钮评估标准**：
  - 保留并实现：功能合理，用户需要，已有或可添加后端支持
  - 暂时禁用：功能合理，但后端未实现，添加"开发中"提示
  - 删除：功能冗余，无实际使用场景，与其他功能重复
- **UI/UX改进**：
  - 所有表单提交添加防抖/节流
  - 添加操作成功/失败的轻提示（ElementPlus的ElMessage）
  - 长时间操作添加进度指示
  - 错误边界处理，友好错误提示

### 不修改范围：
1. 后端API接口签名（保持兼容）
2. 主进程的IPC处理逻辑
3. 数据库结构和数据模型
4. 文件格式（.em格式）的解析/生成逻辑
5. 插件系统的核心生命周期管理

### 验证要点：
1. ✅ 所有按钮点击都有实际效果或明确反馈
2. ✅ 无任何硬编码的模拟数据
3. ✅ 插件安装使用文件夹选择器
4. ✅ 所有数据修改都通过IPC与主进程通信
5. ✅ 保持现有功能完整，不破坏现有工作流

---

## 段落4：设置页面优化需求

**总体要求**：仅修改前端渲染进程代码，不修改后端API/主进程逻辑

### 特殊要求：
1. **移除无效配置项**：
   - 检查所有设置项，删除"开发中"或"占位符"配置
   - 对于必要的占位项（如"云同步"），添加禁用状态和提示文字

2. **连接实际配置**：
   - 通过ipc获取当前配置
   - 所有配置修改通过ipc保存,且保存按钮需要有相应反馈
   - 添加配置保存状态提示（成功/失败）

3. **优化配置分类**：
   - 使用标签页或折叠面板组织设置项：
     * 常规设置：主题、语言、启动选项
     * 数据设置：备份路径、自动保存间隔
     * 插件设置：插件安装目录、自动更新
     * 高级设置：开发者选项、日志级别

### 通用要求：
- **按钮评估标准**：
  - 保留并实现：功能合理，用户需要，已有或可添加后端支持
  - 暂时禁用：功能合理，但后端未实现，添加"开发中"提示
  - 删除：功能冗余，无实际使用场景，与其他功能重复
- **UI/UX改进**：
  - 所有表单提交添加防抖/节流
  - 添加操作成功/失败的轻提示（ElementPlus的ElMessage）
  - 长时间操作添加进度指示
  - 错误边界处理，友好错误提示

### 不修改范围：
1. 后端API接口签名（保持兼容）
2. 主进程的IPC处理逻辑
3. 数据库结构和数据模型
4. 文件格式（.em格式）的解析/生成逻辑
5. 插件系统的核心生命周期管理

### 验证要点：
1. ✅ 所有按钮点击都有实际效果或明确反馈
2. ✅ 无任何硬编码的模拟数据
3. ✅ 所有数据修改都通过IPC与主进程通信
4. ✅ 保持现有功能完整，不破坏现有工作流

---

## 段落5：使用说明

请按照以下顺序进行优化：
1. 先优化实体管理页面
2. 再优化看板页面  
3. 接着优化插件管理页面
4. 最后优化设置页面

每个页面优化后请进行功能测试，确保前端修改不影响现有功能。重点检查：
- 按钮点击是否正常工作
- 数据是否正确显示
- 表单提交是否成功
- 错误处理是否恰当

每个页面优化都是独立的，可以单独提供这些段落给大模型进行处理。
